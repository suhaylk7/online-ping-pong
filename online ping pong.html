<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Online Ping Pong</title>
    <style>
        body { background: #222; margin: 0; overflow: hidden; }
        canvas { display: block; margin: 0 auto; background: #111; }
        #info { color: #fff; text-align: center; font-family: sans-serif; }
    </style>
</head>
<body>
    <div id="info">Waiting for another player...</div>
    <canvas id="pong" width="800" height="500"></canvas>
    <script src="https://cdn.jsdelivr.net/npm/socket.io-client@4.7.5/dist/socket.io.min.js"></script>
    <script>
        // --- Setup ---
        const canvas = document.getElementById('pong');
        const ctx = canvas.getContext('2d');
        const info = document.getElementById('info');
        const socket = io('https://pingpong-server.glitch.me'); // Demo server, replace with your own for production

        // --- Game State ---
        let game = {
            players: 0,
            you: 0, // 0 = left, 1 = right
            paddles: [250, 250],
            ball: { x: 400, y: 250, vx: 5, vy: 3 },
            score: [0, 0],
            running: false
        };

        // --- Draw Function ---
        function draw() {
            ctx.clearRect(0, 0, 800, 500);
            // Middle line
            ctx.strokeStyle = "#444";
            ctx.setLineDash([10, 10]);
            ctx.beginPath();
            ctx.moveTo(400, 0);
            ctx.lineTo(400, 500);
            ctx.stroke();
            ctx.setLineDash([]);

            // Paddles
            ctx.fillStyle = "#fff";
            ctx.fillRect(20, game.paddles[0] - 50, 10, 100);
            ctx.fillRect(770, game.paddles[1] - 50, 10, 100);

            // Ball
            ctx.beginPath();
            ctx.arc(game.ball.x, game.ball.y, 10, 0, Math.PI * 2);
            ctx.fill();

            // Score
            ctx.font = "40px sans-serif";
            ctx.fillText(game.score[0], 350, 50);
            ctx.fillText(game.score[1], 430, 50);
        }

        // --- Input Handling ---
        let up = false, down = false;
        document.addEventListener('keydown', e => {
            if (e.key === 'w') up = true;
            if (e.key === 's') down = true;
        });
        document.addEventListener('keyup', e => {
            if (e.key === 'w') up = false;
            if (e.key === 's') down = false;
        });

        // --- Game Loop ---
        function loop() {
            if (game.running) {
                // Only move your own paddle
                let move = 0;
                if (up) move -= 7;
                if (down) move += 7;
                if (move !== 0) {
                    socket.emit('move', move);
                }
            }
            draw();
            requestAnimationFrame(loop);
        }

        // --- Socket Events ---
        socket.on('connect', () => {
            info.textContent = "Connected. Waiting for another player...";
        });

        socket.on('init', data => {
            game.you = data.you;
            info.textContent = "Waiting for another player...";
        });

        socket.on('start', () => {
            game.running = true;
            info.textContent = "Game started! Use W/S to move.";
        });

        socket.on('state', state => {
            game.paddles = state.paddles;
            game.ball = state.ball;
            game.score = state.score;
        });

        socket.on('players', count => {
            game.players = count;
            if (count < 2) {
                info.textContent = "Waiting for another player...";
                game.running = false;
            }
        });

        socket.on('end', winner => {
            info.textContent = winner === game.you ? "You win!" : "You lose!";
            game.running = false;
        });

        // --- Start Loop ---
        loop();
    </script>
</body>
</html>
